<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vrei sƒÉ fii Dragobetele meu?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;700&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #fff5f5;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        .cursive {
            font-family: 'Dancing+Script', cursive;
        }

        .trad-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 0l5 15h15l-12 9 5 16-13-10-13 10 5-16-12-9h15z' fill='%23e53e3e' fill-opacity='0.05'/%3E%3C/svg%3E");
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        #noButton, #yesButton {
            transition: all 0.2s ease-in-out;
        }

        .heart-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .admin-panel {
            border-top: 1px dashed #fee2e2;
            margin-top: 50px;
            padding-top: 20px;
        }
    </style>
</head>
<body class="trad-pattern flex flex-col items-center justify-center min-h-screen p-4">

    <div class="relative w-full max-w-lg pt-12">
        <!-- Decorative Top Elements - Moved inside a relative wrapper for better alignment -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 flex gap-4 z-10">
            <span class="text-4xl floating">‚ù§Ô∏è</span>
            <span class="text-4xl floating" style="animation-delay: 0.5s">üåπ</span>
            <span class="text-4xl floating" style="animation-delay: 1s">‚ù§Ô∏è</span>
        </div>

        <div id="mainContainer" class="bg-white/80 backdrop-blur-sm p-8 md:p-12 rounded-3xl shadow-2xl border-4 border-red-100 text-center relative">
            
            <div id="questionState">
                <h1 class="text-3xl md:text-5xl font-bold text-red-600 mb-6 cursive">
                    Vrei sƒÉ fii Dragobetele meu?
                </h1>
                
                <div class="mb-8">
                    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOHYwdWpndm96NHR4bmE1eHhhb2YyYndueGhzNTh6ZzJqZzZqZzZqJmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZNo/L13NsH0Aij4Sf2Gdjt/giphy.gif" 
                         alt="Cute bear" 
                         class="rounded-xl mx-auto shadow-lg w-64 h-64 object-cover">
                </div>

                <p id="funnyMessage" class="text-gray-600 mb-8 h-6 italic"></p>

                <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
                    <button id="yesButton" 
                            class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transform active:scale-95 transition-all">
                        DA!
                    </button>
                    
                    <button id="noButton" 
                            class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-8 rounded-full shadow-md transform active:scale-95">
                        Nu
                    </button>
                </div>
            </div>

            <div id="successState" class="hidden animate-bounce">
                <h1 class="text-4xl md:text-6xl font-bold text-red-600 mb-6 cursive">
                    »òtiam eu! ‚ù§Ô∏è
                </h1>
                <p class="text-xl text-gray-700 mb-8">
                    Abia a»ôtept sƒÉ sƒÉrbƒÉtorim √ÆmpreunƒÉ!
                </p>
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHN3Y2R3dzBqZ3E0eHhuN3l4bmR3eHhuaHh4eHh4eHh4eHh4eHgmZXA9djFfaW50ZXJuYWxfZ2lmX2J5X2lkJmN0PWc/f66AOk0N8WnN96rC5M/giphy.gif" 
                     class="rounded-xl mx-auto shadow-lg w-64"
                     alt="Celebration">
            </div>
        </div>
    </div>

    <!-- Owner Dashboard -->
    <div class="admin-panel w-full max-w-xs text-center opacity-30 hover:opacity-100 transition-opacity">
        <button id="toggleAdmin" class="text-xs text-gray-400 underline mb-2">Panou Control (Doar pentru tine)</button>
        <div id="adminContent" class="hidden bg-white p-4 rounded-lg shadow-inner text-left text-sm">
            <p class="font-bold text-red-500 mb-2">Status RƒÉspuns:</p>
            <div id="responseStatus" class="text-gray-600">Se √ÆncarcƒÉ...</div>
        </div>
    </div>

    <canvas id="heartsCanvas" class="heart-bg"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Firebase Configuration
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'dragobete-app';

        let currentUser = null;

        // Initialize Auth
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                setupRealtimeListener();
            }
        });

        initAuth();

        const yesBtn = document.getElementById('yesButton');
        const noBtn = document.getElementById('noButton');
        const questionState = document.getElementById('questionState');
        const successState = document.getElementById('successState');
        const funnyMessage = document.getElementById('funnyMessage');
        const responseStatus = document.getElementById('responseStatus');

        let yesScale = 1;
        let noScale = 1;
        let noCount = 0;

        const messages = ["E»ôti sigurƒÉ?", "Mai g√¢nde»ôte-te o datƒÉ...", "Chiar vrei sƒÉ spui nu?", "O sƒÉ pl√¢ng... üò¢", "UitƒÉ-te ce mare s-a fƒÉcut butonul de DA!", "Hai te rooog!", "Nu mai ai mult loc de butonul de NU...", "ApasƒÉ pe ƒÉla ro»ôu, e mai frumos!"];

        noBtn.addEventListener('click', () => {
            noCount++;
            yesScale += 0.45;
            yesBtn.style.transform = `scale(${yesScale})`;
            noScale -= 0.1;
            if (noScale < 0.2) noScale = 0.2;
            noBtn.style.transform = `scale(${noScale})`;
            funnyMessage.innerText = messages[Math.min(noCount - 1, messages.length - 1)];
            
            const x = Math.random() * 40 - 20;
            const y = Math.random() * 40 - 20;
            noBtn.style.translate = `${x}px ${y}px`;
        });

        yesBtn.addEventListener('click', async () => {
            questionState.classList.add('hidden');
            successState.classList.remove('hidden');
            startConfetti();

            // SAVE THE RESPONSE TO CLOUD
            if (currentUser) {
                try {
                    const responseDoc = doc(db, 'artifacts', appId, 'public', 'data', 'responses', 'her-answer');
                    await setDoc(responseDoc, {
                        answered: true,
                        timestamp: new Date().toLocaleString('ro-RO'),
                        attempts: noCount
                    });
                } catch (e) {
                    console.error("Error saving response:", e);
                }
            }
        });

        // Realtime listener for the Owner Dashboard
        function setupRealtimeListener() {
            const responseDoc = doc(db, 'artifacts', appId, 'public', 'data', 'responses', 'her-answer');
            onSnapshot(responseDoc, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    responseStatus.innerHTML = `
                        <p class="text-green-600 font-bold">A SPUS DA! ‚ù§Ô∏è</p>
                        <p class="text-xs">Data: ${data.timestamp}</p>
                        <p class="text-xs">A √Æncercat sƒÉ zicƒÉ NU de ${data.attempts} ori.</p>
                    `;
                } else {
                    responseStatus.innerText = "√éncƒÉ nu a rƒÉspuns...";
                }
            }, (error) => {
                responseStatus.innerText = "Eroare la √ÆncƒÉrcare.";
            });
        }

        // Toggle Admin Panel
        document.getElementById('toggleAdmin').addEventListener('click', () => {
            const content = document.getElementById('adminContent');
            content.classList.toggle('hidden');
        });

        // Background Animation
        const canvas = document.getElementById('heartsCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height + 20;
                this.size = Math.random() * 15 + 5;
                this.speed = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.5 + 0.2;
            }
            update() { this.y -= this.speed; if (this.y < -20) this.reset(); }
            draw() {
                ctx.fillStyle = `rgba(229, 62, 62, ${this.opacity})`;
                ctx.beginPath();
                const x = this.x; const y = this.y; const s = this.size;
                ctx.moveTo(x, y + s / 4);
                ctx.quadraticCurveTo(x, y, x + s / 2, y);
                ctx.quadraticCurveTo(x + s, y, x + s, y + s / 4);
                ctx.quadraticCurveTo(x + s, y + s / 2, x + s / 2, y + s * 0.8);
                ctx.quadraticCurveTo(x, y + s / 2, x, y + s / 4);
                ctx.fill();
            }
        }

        for(let i = 0; i < 30; i++) particles.push(new Particle());
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();
        function startConfetti() { particles.forEach(p => { p.speed *= 5; p.opacity = 1; }); }
    </script>
</body>
</html>
